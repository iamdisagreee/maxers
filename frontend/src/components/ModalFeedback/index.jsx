import React, { useEffect, useState } from 'react';
import './ModalFeedback.css';

export default function ModalConfirm2() {
  const [isOpen, setIsOpen] = useState(true); // модалка изначально открыта
  // selectedFace: 0 = веселое, 1 = норм, 2 = грустное; null = ничего не выбрано
  const [selectedFace, setSelectedFace] = useState(null);

  // Сбрасываем выбор при монтировании и каждый раз, когда модалка открывается.
  // Это гарантирует, что ничего не будет "помнить".
  useEffect(() => {
    if (isOpen) setSelectedFace(null);
  }, [isOpen]);

  if (!isOpen) return null; // если закрыта — не рендерим

  const faces = [
    { id: 0, title: 'Весёлое', aria: 'happy' },
    { id: 1, title: 'Норм', aria: 'neutral' },
    { id: 2, title: 'Грустное', aria: 'sad' },
  ];

  function onFaceClick(idx) {
    setSelectedFace(idx);
  }

  function handleConfirm() {
    console.log('Подтверждено! Выбранный индекс:', selectedFace);
    // тут можно вызывать проп onSubmit или API
    setIsOpen(false);
  }

  return (
    <div className="modal-bg" role="dialog" aria-modal="true" aria-labelledby="modal-feedback-title">
      <div className="modal-wrapper">
        <span id="modal-feedback-title" className="modal-text inter-500 h6">Уверены в своём выборе?</span>

        <div
          className="modal-faces"
          role="radiogroup"
          aria-label="Выбор лица"
        >
          {faces.map((f, idx) => {
            const isActive = selectedFace === idx;
            const faceClass = `modal-face${isActive ? ' modal-face-active' : ''}`;

            return (
              <button
                key={f.id}
                type="button"
                className="modal-face-button"
                onClick={() => onFaceClick(idx)}
                aria-pressed={isActive}
                aria-label={f.title}
                style={{ background: 'transparent', border: 'none', padding: 0, cursor: 'pointer' }}
              >
                {idx === 0 && (
                  <svg className={faceClass} width="48" height="48" viewBox="0 0 48 48" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                    {/* happy svg path (как в твоём исходнике) */}
                    <path d="M31 22C31.8333 22 32.5420 21.7087 33.126 21.126C33.71 20.5433 34.0013 19.8347 34 19C33.9987 18.1653 33.7073 17.4573 33.126 16.876C32.5447 16.2947 31.836 16.0027 31 16C30.164 15.9973 29.456 16.2893 28.876 16.876C28.296 17.4627 28.004 18.1707 28 19C27.996 19.8293 28.288 20.538 28.876 21.126C29.464 21.714 30.172 22.0053 31 22ZM17 22C17.8333 22 18.5420 21.7087 19.126 21.126C19.71 20.5433 20.0013 19.8347 20 19C19.9987 18.1653 19.7073 17.4573 19.126 16.876C18.5447 16.2947 17.836 16.0027 17 16C16.164 15.9973 15.456 16.2893 14.876 16.876C14.296 17.4627 14.004 18.1707 14 19C13.996 19.8293 14.288 20.538 14.876 21.126C15.464 21.714 16.172 22.0053 17 22ZM24 44C21.2333 44 18.6333 43.4747 16.2 42.424C13.7667 41.3733 11.65 39.9487 9.85 38.15C8.05 36.3513 6.62534 34.2347 5.576 31.8C4.52667 29.3653 4.00134 26.7653 4 24C3.99867 21.2347 4.524 18.6347 5.576 16.2C6.628 13.7653 8.05267 11.6487 9.85 9.85C11.6473 8.05133 13.764 6.62667 16.2 5.576C18.636 4.52533 21.236 4 24 4C26.764 4 29.364 4.52533 31.8 5.576C34.236 6.62667 36.3527 8.05133 38.15 9.85C39.9473 11.6487 41.3727 13.7653 42.426 16.2C43.4793 18.6347 44.004 21.2347 44 24C43.996 26.7653 43.4707 29.3653 42.424 31.8C41.3773 34.2347 39.9527 36.3513 38.15 38.15C36.3473 39.9487 34.2307 41.374 31.8 42.426C29.3693 43.478 26.7693 44.0027 24 44ZM24 40C28.4667 40 32.25 38.45 35.35 35.35C38.45 32.25 40 28.4667 40 24C40 19.5333 38.45 15.75 35.35 12.65C32.25 9.55 28.4667 8 24 8C19.5333 8 15.75 9.55 12.65 12.65C9.55 15.75 8 19.5333 8 24C8 28.4667 9.55 32.25 12.65 35.35C15.75 38.45 19.5333 40 24 40ZM24 27C22.1 27 20.3167 27.4667 18.65 28.4C16.9833 29.3333 15.65 30.6167 14.65 32.25C14.45 32.65 14.4667 33.042 14.7 33.426C14.9333 33.81 15.2833 34.0013 15.75 34H32.2C32.6667 34 33.0167 33.808 33.25 33.424C33.4833 33.04 33.5 32.6487 33.3 32.25C32.3 30.6167 30.9753 29.3333 29.326 28.4C27.6767 27.4667 25.9013 27 24 27Z" fill="currentColor"/>
                  </svg>
                )}
                {idx === 1 && (
                  <svg className={faceClass} width="48" height="48" viewBox="0 0 48 48" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                    <path d="M24 44C12.954 44 4 35.046 4 24C4 12.954 12.954 4 24 4C35.046 4 44 12.954 44 24C44 35.046 35.046 44 24 44ZM24 40C28.2435 40 32.3131 38.3143 35.3137 35.3137C38.3143 32.3131 40 28.2435 40 24C40 19.7565 38.3143 15.6869 35.3137 12.6863C32.3131 9.68571 28.2435 8 24 8C19.7565 8 15.6869 9.68571 12.6863 12.6863C9.68571 15.6869 8 19.7565 8 24C8 28.2435 9.68571 32.3131 12.6863 35.3137C15.6869 38.3143 19.7565 40 24 40ZM16 28H32V32H16V28ZM16 22C15.2044 22 14.4413 21.6839 13.8787 21.1213C13.3161 20.5587 13 19.7956 13 19C13 18.2044 13.3161 17.4413 13.8787 16.8787C14.4413 16.3161 15.2044 16 16 16C16.7956 16 17.5587 16.3161 18.1213 16.8787C18.6839 17.4413 19 18.2044 19 19C19 19.7956 18.6839 20.5587 18.1213 21.1213C17.5587 21.6839 16.7956 22 16 22ZM32 22C31.2044 22 30.4413 21.6839 29.8787 21.1213C29.3161 20.5587 29 19.7956 29 19C29 18.2044 29.3161 17.4413 29.8787 16.8787C30.4413 16.3161 31.2044 16 32 16C32.7956 16 33.5587 16.3161 34.1213 16.8787C34.6839 17.4413 35 18.2044 35 19C35 19.7956 34.6839 20.5587 34.1213 21.1213C33.5587 21.6839 32.7956 22 32 22Z" fill="currentColor"/>
                  </svg>
                )}
                {idx === 2 && (
                  <svg className={faceClass} width="48" height="48" viewBox="0 0 48 48" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                    <path fillRule="evenodd" clipRule="evenodd" d="M24 8C19.7565 8 15.6869 9.68571 12.6863 12.6863C9.68571 15.6869 8 19.7565 8 24C8 28.2435 9.68571 32.3131 12.6863 35.3137C15.6869 38.3143 19.7565 40 24 40C28.2435 40 32.3131 38.3143 35.3137 35.3137C38.3143 32.3131 40 28.2435 40 24C40 19.7565 38.3143 15.6869 35.3137 12.6863C32.3131 9.68571 28.2435 8 24 8ZM4 24C4 12.954 12.954 4 24 4C35.046 4 44 12.954 44 24C44 35.046 35.046 44 24 44C12.954 44 4 35.046 4 24ZM17 20C16.61 20 16.112 20.248 15.788 20.896C15.5479 21.366 15.1318 21.722 14.6303 21.8865C14.1289 22.051 13.5827 22.0106 13.1109 21.7742C12.6391 21.5378 12.2798 21.1244 12.1115 20.6243C11.9431 20.1241 11.9792 19.5776 12.212 19.104C13.084 17.36 14.826 16 17 16C19.174 16 20.914 17.36 21.788 19.104C22.0208 19.5776 22.0569 20.1241 21.8885 20.6243C21.7202 21.1244 21.3609 21.5378 20.8891 21.7742C20.4173 22.0106 19.8711 22.051 19.3697 21.8865C18.8682 21.722 18.4521 21.366 18.212 20.896C17.888 20.248 17.392 20 17 20ZM31 20C30.61 20 30.112 20.248 29.788 20.896C29.6716 21.1329 29.5094 21.3444 29.3109 21.5183C29.1123 21.6922 28.8813 21.8251 28.6312 21.9093C28.381 21.9935 28.1167 22.0274 27.8534 22.009C27.5901 21.9905 27.333 21.9202 27.097 21.8019C26.8611 21.6837 26.6508 21.5199 26.4784 21.32C26.3061 21.1201 26.175 20.8881 26.0927 20.6373C26.0104 20.3865 25.9786 20.1219 25.9991 19.8587C26.0196 19.5955 26.0919 19.3391 26.212 19.104C27.086 17.36 28.826 16 31 16C33.174 16 34.914 17.36 35.788 19.104C36.0208 19.5776 36.0569 20.1241 35.8885 20.6243C35.7202 21.1244 35.3609 21.5378 34.8891 21.7742C34.4173 22.0106 33.8711 22.051 33.3697 21.8865C32.8682 21.722 32.4521 21.366 32.212 20.896C31.888 20.248 31.392 20 31 20ZM17.208 28.676C17.3818 28.4789 17.5928 28.318 17.8288 28.2025C18.0648 28.087 18.3213 28.0192 18.5835 28.0028C18.8458 27.9865 19.1087 28.022 19.3572 28.1073C19.6058 28.1926 19.8351 28.326 20.032 28.5C21.092 29.436 22.478 30 24 30C25.522 30 26.91 29.436 27.968 28.5C28.3658 28.1489 28.8868 27.9701 29.4165 28.0031C29.9461 28.0361 30.4409 28.2782 30.792 28.676C31.1431 29.0738 31.3219 29.5948 31.2889 30.1245C31.2559 30.6541 31.0138 31.1489 30.616 31.5C28.7908 33.1146 26.4369 34.0041 24 34C21.5631 34.0041 19.2092 33.1146 17.384 31.5C17.1869 31.3262 17.026 31.1152 16.9105 30.8792C16.795 30.6432 16.7272 30.3867 16.7108 30.1245C16.6945 29.8622 16.73 29.5993 16.8153 29.3508C16.9006 29.1022 17.034 28.8729 17.208 28.676Z" fill="currentColor"/>
                  </svg>
                )}
              </button>
            );
          })}
        </div>

        <div className="modal-buttons">
          <div
            className="modal-button gray-button inter-700 p"
            onClick={() => setIsOpen(false)} // закрываем модалку
          >
            Назад
          </div>
          <div
            className="modal-button modal-confirm inter-700 p"
            onClick={() => {
              if (selectedFace === null) return;
              handleConfirm();
            }}
            // когда ничего не выбрано — лёгкий грейскейл (5-10%), иначе — норм
            style={selectedFace === null ? { filter: 'grayscale(0.6)' } : undefined}
            aria-disabled={selectedFace === null}
          >
            Продолжить
          </div>
        </div>
      </div>
    </div>
  );
}
